{"id":"sbmaker-2-00c","title":"Remove or simplify the init command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:41:46.872654-08:00","created_by":"danyel","updated_at":"2026-01-09T13:10:15.771191-08:00","closed_at":"2026-01-09T13:10:15.771191-08:00","close_reason":"Removed init command - create_vm auto-copies templates"}
{"id":"sbmaker-2-07p","title":"Auto-confirm VM start prompt - avoid interactive question","description":"When running 'csb start', Lima asks 'Do you want to start the instance now? Yes/No'. This should be auto-confirmed since the user explicitly ran 'csb start'. Use limactl flags to skip the prompt.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T12:09:59.510443-08:00","created_by":"danyel","updated_at":"2026-01-09T12:12:26.385181-08:00","closed_at":"2026-01-09T12:12:26.385181-08:00","close_reason":"Added --tty=false to limactl create"}
{"id":"sbmaker-2-0s8","title":"Security: Sed injection vulnerability with ANTHROPIC_API_KEY","description":"Line 184 uses sed substitution with unescaped API key. If ANTHROPIC_API_KEY contains |, \u0026, \\, or newlines, sed will break or behave unexpectedly. Should escape the value or use a different substitution method.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T11:48:56.494147-08:00","created_by":"danyel","updated_at":"2026-01-09T11:57:13.286432-08:00","closed_at":"2026-01-09T11:57:13.286432-08:00","close_reason":"Fixed by adding escape_sed_replacement() helper and applying to all template substitutions"}
{"id":"sbmaker-2-1pi","title":"Write a README for users stumbling into this github page","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:04:57.929676-08:00","created_by":"danyel","updated_at":"2026-01-09T11:11:39.330405-08:00","closed_at":"2026-01-09T11:11:39.330405-08:00","close_reason":"Created comprehensive README.md with installation, usage, commands, and architecture"}
{"id":"sbmaker-2-1xi","title":"Bug: Network rules never applied - sandbox isn't sandboxed","description":"template.yaml has copyToHost: [] (empty) but provisioning script checks for /tmp/network-rules.sh. Nothing copies the network rules into the VM, so the firewall allowlist is never configured. Critical security gap.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T11:48:56.320088-08:00","created_by":"danyel","updated_at":"2026-01-09T11:56:18.09036-08:00","closed_at":"2026-01-09T11:56:18.09036-08:00","close_reason":"Fixed by embedding network rules directly in template.yaml provisioning script"}
{"id":"sbmaker-2-3k2","title":"beads install causes cd errors during VM provisioning","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T12:09:43.076884-08:00","created_by":"danyel","updated_at":"2026-01-09T12:13:10.819278-08:00","closed_at":"2026-01-09T12:13:10.819278-08:00","close_reason":"Closed","comments":[{"id":2,"issue_id":"sbmaker-2-3k2","author":"danyel","text":"Error seen during VM provisioning:\n```\n[csb] Installing base packages (git, tmux, python3, nodejs) ⠴\nbash: line 1: cd: /Users/danyel/code/MISC/torahmap2: No such file or directory\nbash: line 1: cd: /Users/danyel: No such file or directory\n```\n\nThe error comes from `npm install -g @anthropic-ai/beads` which appears to trigger some initialization that tries to cd to host paths that don't exist inside the VM.\n\nThe VM only has /workspace mounted. Beads might be reading ~/.beads or some other config that contains cached paths from the host.","created_at":"2026-01-09T20:09:49Z"},{"id":3,"issue_id":"sbmaker-2-3k2","author":"danyel","text":"Root cause: limactl shell tries to cd to the host's current working directory inside the VM. When run from a directory like /Users/danyel/code/MISC/torahmap2, Lima emits errors because that path doesn't exist inside the VM.\n\nFix: Added --workdir flag to all limactl shell invocations to explicitly specify the working directory inside the VM.","created_at":"2026-01-09T20:13:10Z"}]}
{"id":"sbmaker-2-48k","title":"code review","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:43:22.730448-08:00","created_by":"danyel","updated_at":"2026-01-09T11:49:42.585134-08:00","closed_at":"2026-01-09T11:49:42.585134-08:00","close_reason":"Code review complete. Created 10 issues for findings (2 P1, 3 P2, 3 P3, 2 P4)."}
{"id":"sbmaker-2-cov","title":"Bug: Silent failure on tmux session creation","description":"Line 264 suppresses all errors: 'limactl shell ... 2\u003e/dev/null || true'. If tmux session creation fails, user gets no feedback before the attach attempt fails with a confusing error.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-09T11:48:56.666257-08:00","created_by":"danyel","updated_at":"2026-01-09T11:48:56.666257-08:00"}
{"id":"sbmaker-2-cuq","title":"Low default VM resources may be insufficient","description":"Default 2 CPUs / 2GiB RAM may be tight for Claude Code + npm builds. Consider increasing defaults or documenting how to adjust via 'csb config'.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T11:49:02.289637-08:00","created_by":"danyel","updated_at":"2026-01-09T12:07:16.105793-08:00","closed_at":"2026-01-09T12:07:16.105793-08:00","close_reason":"Bumped defaults to 4 CPUs, 4GiB RAM, 30GiB disk"}
{"id":"sbmaker-2-e3k","title":"Show provisioning progress during startup","description":"During VM startup, show which tools are being provisioned and general progress. Currently just shows a spinner with no indication of what's happening inside the VM.\n\nIdeas:\n- Show stages: 'Installing base packages...', 'Installing Claude Code...', 'Configuring YOLO mode...'\n- Could tail cloud-init logs from the VM\n- Show percentage or step count (e.g., 'Step 2/5: Installing nodejs...')","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T11:39:34.185684-08:00","created_by":"danyel","updated_at":"2026-01-09T12:06:50.515438-08:00","closed_at":"2026-01-09T12:06:50.515438-08:00","close_reason":"Implemented provisioning progress display with CSB_PROGRESS markers and SSH polling"}
{"id":"sbmaker-2-nt9","title":"Still asks 'do you want to create the instance now'","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-09T13:06:09.399803-08:00","created_by":"danyel","updated_at":"2026-01-09T13:06:09.399803-08:00"}
{"id":"sbmaker-2-qnv","title":"Improve startup feedback - reduce verbose Lima messages","description":"At startup, it takes a while with minimal progress. Displays lots of messages like 'INFO[0045] [hostagent] Waiting for the optional requirement 1 of 1: \"user probe 1/1\"'. Need better user feedback during VM creation/startup.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:06:21.589273-08:00","created_by":"danyel","updated_at":"2026-01-09T11:08:21.30904-08:00","closed_at":"2026-01-09T11:08:21.30904-08:00","close_reason":"Added spinner with progress feedback, suppresses verbose Lima output by default. Use --verbose flag or CSB_VERBOSE=true to see full output."}
{"id":"sbmaker-2-r8e","title":"add timing for each step of the csb process","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T13:07:37.882877-08:00","created_by":"danyel","updated_at":"2026-01-09T13:12:41.307799-08:00","closed_at":"2026-01-09T13:12:41.307799-08:00","close_reason":"Added live timing display to csb spinners"}
{"id":"sbmaker-2-rio","title":"Add progressive timing information to csb startup. Let me see how much progress it has made","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-09T13:17:22.557049-08:00","created_by":"danyel","updated_at":"2026-01-09T13:17:22.557049-08:00"}
{"id":"sbmaker-2-rxn","title":"Misleading spinner message for VM creation","description":"Line 191 says 'Downloading VM image' but limactl create does much more (configures VM, sets up mounts, etc.). Message should reflect the full operation.","status":"open","priority":4,"issue_type":"chore","created_at":"2026-01-09T11:49:01.927338-08:00","created_by":"danyel","updated_at":"2026-01-09T11:49:01.927338-08:00"}
{"id":"sbmaker-2-t5u","title":"beads install silently fails in template","description":"template.yaml line 69: 'npm install -g @anthropic-ai/beads || true' silently ignores failures. User won't know beads isn't available until they try to use it.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-09T11:49:02.105964-08:00","created_by":"danyel","updated_at":"2026-01-09T11:49:02.105964-08:00"}
{"id":"sbmaker-2-uux","title":"Bug: -v flag doesn't work, help says -v but code uses -V","description":"Line 477 uses --verbose|-V but help text at line 455 says -v (lowercase). Users trying -v get 'Unknown command.'","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T11:48:56.144979-08:00","created_by":"danyel","updated_at":"2026-01-09T12:03:24.208568-08:00","closed_at":"2026-01-09T12:03:24.208568-08:00","close_reason":"Changed -V to -v in flag parsing to match help text"}
{"id":"sbmaker-2-v0c","title":"Create pre-configured Claude VM","description":"This will be a Lima-powered VM. When the user invokes the script, it should start the VM in the current directory, setting the current directory as \"/workspace\" inside the VM. The VM should have Beads and Claude installed, and should pre-start Claude. It should have limited internet access - only for install sources like github, python repos, npm, and so on. If the user calls the script a second time in the same folder, it should use the same VM.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:23:37.69147-08:00","created_by":"danyel","updated_at":"2026-01-09T10:59:26.593328-08:00","closed_at":"2026-01-09T10:59:26.593328-08:00","close_reason":"Implementation complete: csb CLI with Lima VM template, network allowlist, and all commands implemented","comments":[{"id":1,"issue_id":"sbmaker-2-v0c","author":"danyel","text":"## Design: csb (Claude SandBox)\n\n### Overview\n\nBash CLI tool using Lima VMs for sandboxed Claude development. Each project directory gets its own persistent VM with Claude Code + Superpowers pre-installed, running in YOLO mode.\n\n### Commands\n\n| Command | Description |\n|---------|-------------|\n| `csb start` | Create new Claude session, attach (creates VM on first run) |\n| `csb stop` | Shut down the VM |\n| `csb shell` | Open bash shell inside VM |\n| `csb attach \u003cn\u003e` | Attach to session n (starts VM if stopped) |\n| `csb list` | Show VM status and all sessions |\n| `csb config` | Adjust VM resources (requires restart) |\n| `csb status` | Show VM state |\n\n### Directory Mapping\n\n- `.csb` file in project root stores VM name + config\n- VM name: `csb-\u003c6-char-hash\u003e` (generated once, stored)\n- Moving directory works (name travels with .csb file)\n\n### VM Spec\n\n- **Base:** Debian slim\n- **Default resources:** 2 CPU, 2GB RAM, 20GB disk\n- **Mount:** Current directory → `/workspace`\n- **Session management:** tmux (auto-incrementing session numbers)\n\n### Network Allowlist (category-based)\n\n**Package managers:** pypi.org, registry.npmjs.org, crates.io, rubygems.org, proxy.golang.org\n\n**Code hosts:** github.com, gitlab.com, bitbucket.org (+ raw.githubusercontent.com)\n\n**Claude:** api.anthropic.com, console.anthropic.com, statsig.anthropic.com\n\nEverything else blocked via iptables.\n\n### Provisioning (first run)\n\n1. Create Lima VM from template\n2. Install: tmux, git, curl, build-essential, python3, nodejs\n3. Install: Claude Code CLI, beads, Superpowers plugin\n4. Configure YOLO mode\n5. Apply network restrictions\n\n### File Structure\n\n```\n~/.csb/\n├── template.yaml      # Lima VM template\n├── network-rules.sh   # iptables allowlist\n└── vms/               # (Lima manages in ~/.lima/)\n\n/project/\n└── .csb               # VM name + config\n```\n\n### Implementation\n\nSingle bash script (~200-300 lines) at /usr/local/bin/csb or ~/bin/csb.","created_at":"2026-01-09T18:47:08Z"}]}
{"id":"sbmaker-2-v0c.1","title":"Create Lima VM template (template.yaml)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:54:44.047628-08:00","created_by":"danyel","updated_at":"2026-01-09T10:56:00.263018-08:00","closed_at":"2026-01-09T10:56:00.263018-08:00","close_reason":"Closed","dependencies":[{"issue_id":"sbmaker-2-v0c.1","depends_on_id":"sbmaker-2-v0c","type":"parent-child","created_at":"2026-01-09T10:54:44.048281-08:00","created_by":"danyel"}]}
{"id":"sbmaker-2-v0c.2","title":"Create network allowlist script (network-rules.sh)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:54:44.199181-08:00","created_by":"danyel","updated_at":"2026-01-09T10:56:26.394089-08:00","closed_at":"2026-01-09T10:56:26.394089-08:00","close_reason":"Closed","dependencies":[{"issue_id":"sbmaker-2-v0c.2","depends_on_id":"sbmaker-2-v0c","type":"parent-child","created_at":"2026-01-09T10:54:44.199659-08:00","created_by":"danyel"}]}
{"id":"sbmaker-2-v0c.3","title":"Create main csb bash script","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:54:44.349191-08:00","created_by":"danyel","updated_at":"2026-01-09T10:57:23.301453-08:00","closed_at":"2026-01-09T10:57:23.301453-08:00","close_reason":"Closed","dependencies":[{"issue_id":"sbmaker-2-v0c.3","depends_on_id":"sbmaker-2-v0c","type":"parent-child","created_at":"2026-01-09T10:54:44.349644-08:00","created_by":"danyel"},{"issue_id":"sbmaker-2-v0c.3","depends_on_id":"sbmaker-2-v0c.1","type":"blocks","created_at":"2026-01-09T10:54:50.104089-08:00","created_by":"danyel"},{"issue_id":"sbmaker-2-v0c.3","depends_on_id":"sbmaker-2-v0c.2","type":"blocks","created_at":"2026-01-09T10:54:50.186381-08:00","created_by":"danyel"}]}
{"id":"sbmaker-2-v0c.4","title":"Test csb implementation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T10:54:44.503971-08:00","created_by":"danyel","updated_at":"2026-01-09T10:59:21.813443-08:00","closed_at":"2026-01-09T10:59:21.813443-08:00","close_reason":"Closed","dependencies":[{"issue_id":"sbmaker-2-v0c.4","depends_on_id":"sbmaker-2-v0c","type":"parent-child","created_at":"2026-01-09T10:54:44.504474-08:00","created_by":"danyel"},{"issue_id":"sbmaker-2-v0c.4","depends_on_id":"sbmaker-2-v0c.3","type":"blocks","created_at":"2026-01-09T10:54:50.267103-08:00","created_by":"danyel"}]}
{"id":"sbmaker-2-wk3","title":"Bug: crashes instantly on startup","description":"csb start exits immediately after showing 'Creating VM' message with no error output.\n\nLog:\n```\n[danyel:~/code/MISC/torahmap2] main* 1 ± ../sbmaker-2/csb/csb start\n[csb] Creating VM: csb-575525\n     This may take a few minutes on first run...\n\n[danyel:~/code/MISC/torahmap2] main* 1 ±\n```\n\nThe spinner never appears and no error is shown. Exit code is 1.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T11:10:57.079156-08:00","created_by":"danyel","updated_at":"2026-01-09T11:12:32.983763-08:00","closed_at":"2026-01-09T11:12:32.983763-08:00","close_reason":"Fixed two bugs: 1) vm_exists/vm_status used wrong jq syntax for Lima's JSON Lines output (not array), 2) run_with_spinner now uses || to capture exit code and calls exit directly to show errors before set -e kills script"}
{"id":"sbmaker-2-wvl","title":"Trap only catches EXIT, not INT/TERM","description":"Line 104: trap 'stop_spinner false \"\"' EXIT. Ctrl+C during a spinner could leave terminal in a bad state. Should trap INT and TERM as well.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-09T11:48:57.026361-08:00","created_by":"danyel","updated_at":"2026-01-09T11:48:57.026361-08:00"}
{"id":"sbmaker-2-zaj","title":"UUOC: cat piped to tail","description":"Line 359: cat \"${CSB_FILE}\" | tail -n +2. Should be: tail -n +2 \"${CSB_FILE}\"","status":"open","priority":4,"issue_type":"chore","created_at":"2026-01-09T11:49:01.741074-08:00","created_by":"danyel","updated_at":"2026-01-09T11:49:01.741074-08:00"}
{"id":"sbmaker-2-zbc","title":"DNS-based firewall is fragile - IPs change over time","description":"network-rules.sh resolves domains to IPs at setup time. CDNs rotate IPs constantly, so the allowlist drifts out of date. Consider using domain-based filtering (iptables with string match or a proxy) instead.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-09T11:48:56.843726-08:00","created_by":"danyel","updated_at":"2026-01-09T11:48:56.843726-08:00"}
